import{j as e,u as z,a as P,D as ee,H as se}from"./react-dnd-D9QuKJuj.js";import{r as u}from"./react-vendor-D4ezllkW.js";import{u as O,r as M,C as D}from"./editorConfig-BiRaxP5A.js";import{B as H,E as te,c as ne,I as N,C as oe,T as F,a as le,D as L,b as ae,M as ce,R as q,d as re,S as ie,F as I}from"./antd-BFWf-pza.js";import{d as R}from"./deepcopy-Dtiv1-Q2.js";import"./zustand-B3K13JpZ.js";const V=u.createContext({}),de=()=>{const s=O(),[t,r]=u.useState(s.components),[h,j]=u.useState(null),m=u.useRef(!1);return{deletedIndex:u.useRef(0),addStatus:m,components:t,curComponent:h,addComponent:C=>{r(p=>[...p,C])},setComponents:r,selectComponent:C=>{j(C||null)}}},T=()=>u.useContext(V),pe=({children:s})=>{const t=de();return e.jsx(V.Provider,{value:t,children:s})},ue="_header_9llhd_1",me={header:ue},he=()=>{const{components:s}=T(),{setComponents:t}=O(),r=()=>{t(s),window.open("/preview","_blank")};return e.jsx("header",{className:me.header,children:e.jsx(H,{icon:e.jsx(te,{}),type:"primary",onClick:r,children:"预览"})})},ge=u.memo(he),fe="_material_ak776_1",_e="_item_ak776_10",A={material:fe,item:_e},je=s=>{const{addComponent:t,addStatus:r}=T(),[{isDragging:h},j]=z(()=>({type:s.type,end(m,a){if(!a.getDropResult()||!s)return;const y={...s,id:new Date().getTime().toString()};t(y)},collect:m=>({isDragging:m.isDragging()})}));return u.useEffect(()=>{r.current=h},[h]),e.jsx("div",{ref:j,style:{opacity:h?.4:1},className:A.item,children:s.label})},xe=()=>e.jsx("section",{className:A.material,children:M.components.map(s=>e.jsx(je,{...s},s.type))}),Ce=u.memo(xe),ve=(s,t=500)=>{let r=null;return(...j)=>{r!==null&&(clearTimeout(r),r=null),r=setTimeout(()=>s(...j),t)}},be="_stage_8d82q_1",ye="_container_8d82q_11",Ne="_header_8d82q_23",ke="_title_8d82q_27",De="_desc_8d82q_30",Ee="_item_8d82q_33",Re="_label_8d82q_44",Se="_right_8d82q_50",qe="_component_8d82q_54",Te="_bottom_8d82q_57",we="_add_8d82q_62",Oe="_action_8d82q_71",$e="_tool_8d82q_83",Me="_active_8d82q_91",_={stage:be,container:ye,header:Ne,title:ke,desc:De,item:Ee,label:Re,right:Se,component:qe,bottom:Te,add:we,action:Oe,tool:$e,active:Me},Fe=({componentItem:s,index:t,selecteds:r,setSelecteds:h,selectComponentItem:j})=>{const{label:m,type:a,isAdd:x}=s,{render:y}=M.componentMap[a],C=u.useRef(null),{addStatus:p,deletedIndex:g,curComponent:d,components:n,setComponents:l,selectComponent:v}=T(),k=(c,i)=>{l(o=>([o[c],o[i]]=[o[i],o[c]],[...o])),d&&(v(n[i]),h(o=>o.map((f,b)=>b===c)))},[{isDragging:$},K]=z(()=>({type:a,item:{index:t},end(c,i){const o=i.getDropResult();c&&o&&!p.current&&o.index!==void 0&&k(c.index,o.index)},collect:c=>({isDragging:c.isDragging()})})),[Xe,U]=P(()=>({accept:Object.values(D),hover(c){c.index!==t&&!p.current&&(k(c.index,t),c.index=t)}})),G={onDelete(c){l(i=>{const o=R(i.find(b=>b.id===s.id)),f=o.props.options;return o.props.options=f.filter((b,E)=>E!==c),i.map(b=>b.id===s.id?{...b,...o}:b)})},onChange(c,i){l(o=>{const f=R(o.find(E=>E.id===s.id)),b=f.props.options;return b[i].label=c,o.map(E=>E.id===s.id?{...E,...f}:E)})}},W=()=>{j(s,t)},J=()=>{l(c=>{const i=R(c.find(f=>f.id===s.id)),o=i.props.options;return o.push({label:"请输入",value:`${o[o.length-1].value+1}`}),c.map(f=>f.id===s.id?{...f,...i}:f)})},Q=c=>{l(i=>i.map(o=>o.id===s.id?{...o,label:c.target.value}:o))},X=c=>{l(i=>i.map(o=>o.id===s.id?{...o,props:{...o.props,required:c.target.checked}}:o))},Y=c=>{c.stopPropagation();const i=R(s);i.id=new Date().getTime().toString(),l(o=>{if(t===o.length-1)return[...o,i];const f=o.slice(0,t+1),b=o.slice(t+1,o.length);return[...f,i,...b]})},Z=c=>{c.stopPropagation(),l(o=>o.filter(f=>f.id!==s.id)),g.current=t===0?1:t-1;const i=n[g.current];v({...i})};return e.jsxs("div",{ref:K(U(C)),className:ne(_.item,{[_.active]:r[t]}),style:{opacity:$?.4:1},onClick:W,children:[e.jsxs("div",{className:_.label,children:[t<9?`0${t+1}`:t+1,"."]}),e.jsxs("div",{className:_.right,children:[e.jsx(N,{defaultValue:m,onChange:Q}),e.jsx("div",{className:_.component,children:y(s.props,G)}),r[t]?e.jsxs("div",{className:_.bottom,style:{justifyContent:x?"space-between":"flex-end"},children:[x&&e.jsx("span",{className:_.add,onClick:J,children:"添加选项"}),e.jsx(oe,{checked:s.props.required,onChange:X,children:"必填"})]}):null]}),e.jsxs("div",{className:_.action,style:{opacity:r[t]?1:0,visibility:r[t]?"visible":"hidden"},children:[e.jsx(F,{title:"复制",children:e.jsx("div",{className:_.tool,onClick:Y,children:e.jsx(le,{})})}),e.jsx(F,{title:"删除",children:e.jsx("div",{className:_.tool,onClick:Z,children:e.jsx(L,{})})})]})]})},Be=()=>{const{components:s,deletedIndex:t,selectComponent:r}=T(),{form:h,setForm:j}=O(),[m,a]=u.useState(s.map(()=>!1)),x=u.useRef(!0),[y,C]=P(()=>({accept:Object.values(D)})),p=()=>{r(),a(n=>n.map(()=>!1))},g=ve((n,l)=>{h[l]=n,j({...h})}),d=(n,l)=>{x.current=!1,n&&l!==void 0&&!m[l]&&(r(n),a(v=>v.map((k,$)=>$===l)))};return u.useEffect(()=>{if(s.length===0&&r(),s.length===1&&!x.current&&a([!0]),s.length>m.length){a(s.map((n,l)=>m[l]||!1));return}if(s.length<m.length){a(s.map((n,l)=>t.current===l));return}},[s.length,m.length]),u.useEffect(()=>{const n=l=>{l.preventDefault()};window.addEventListener("beforeunload",n)},[]),e.jsx("section",{className:_.stage,children:e.jsxs("div",{ref:C,className:_.container,children:[e.jsxs("div",{className:_.header,onClick:p,children:[e.jsx(N,{onChange:n=>g(n.target.value,"title"),className:_.title,placeholder:"请输入标题"}),e.jsx(N.TextArea,{onChange:n=>g(n.target.value,"description"),className:_.desc,placeholder:"请输入描述"})]}),s.map((n,l)=>e.jsx(Fe,{selecteds:m,selectComponentItem:d,setSelecteds:a,componentItem:n,index:l},n.id))]})})},ze="_options_1bz7c_1",Pe="_option_1bz7c_1",He="_tools_1bz7c_11",Le="_tool_1bz7c_11",w={options:ze,option:Pe,tools:He,tool:Le},Ie=({options:s})=>{const{curComponent:t,setComponents:r}=T(),[h,j]=u.useState(!1),[m,a]=u.useState({}),x=u.useRef(0),y=(d,n)=>{x.current=n,j(!0),a({...d})},C=()=>{j(!1)},p=d=>{if(t){const n=s.filter((v,k)=>k!==d),l=R(t);r(v=>(l.props={...l.props,options:n},v.map(k=>k.id===l.id?l:k)))}},g=()=>{if(t){const d=s.map((l,v)=>v===x.current?{...l,...m}:l),n=R(t);r(l=>(n.props={...n.props,options:d},l.map(v=>v.id===n.id?n:v)))}C()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:w.options,children:s?s.map((d,n)=>e.jsxs("div",{className:w.option,children:[e.jsxs("span",{children:[d.value,"：",d.label]}),e.jsxs("div",{className:w.tools,children:[e.jsx("div",{className:w.tool,onClick:()=>y(d,n),children:e.jsx(ae,{})}),e.jsx("div",{className:w.tool,onClick:()=>p(n),children:e.jsx(L,{})})]})]},d.value)):null}),e.jsxs(ce,{open:h,title:m.value,onCancel:C,onOk:g,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:24},children:[e.jsx("div",{children:"label"}),e.jsx(N,{onChange:d=>{a(n=>({...n,label:d.target.value}))},style:{width:250},value:m.label})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[e.jsx("div",{children:"value"}),e.jsx(N,{onChange:d=>{a(n=>({...n,value:d.target.value}))},style:{width:250},value:m.value})]})]})]})},Ve="_setting_1va1k_1",Ae="_num_1va1k_7",Ke={setting:Ve,num:Ae},{useForm:Ue,Item:S}=I,Ge={[D.INPUT]:()=>e.jsx(N,{}),[D.RADIO]:s=>e.jsx(q.Group,{children:s==null?void 0:s.map(t=>e.jsx(q.Button,{value:t.value,children:t.label},t.value))}),[D.INPUT_NUMBER]:()=>e.jsx(re,{}),[D.SWITCH]:()=>e.jsx(ie,{}),[D.SELECT]:s=>e.jsx(Ie,{options:s})},We=()=>{const[s]=Ue(),{form:t,setForm:r}=O(),{curComponent:h,components:j,setComponents:m}=T(),a=j.find(p=>p.id===(h==null?void 0:h.id)),{configs:x,configKeys:y}=u.useMemo(()=>{if(!a)return{configs:{},configKeys:[]};const p=M.componentMap[a.type].configs;return{configs:p,configKeys:Object.keys(p)}},[a]),C=p=>{if(a){const g=R(a);g.props={...g.props,...p},m(d=>(g.props={...g.props,...p},d.map(n=>n.id===g.id?g:n)))}else r(p)};return u.useEffect(()=>{a&&s.setFieldsValue(a.props)},[a]),u.useEffect(()=>{s.setFieldsValue(t)},[t]),e.jsx("section",{className:Ke.setting,children:e.jsxs(I,{layout:"vertical",form:s,onFinish:C,children:[a?y.map(p=>{const{type:g,label:d,options:n}=x[p];return e.jsx(S,{label:d,name:p,children:Ge[g](g===D.SELECT?a.props.options:n)},p)}):e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"标题",name:"title",children:e.jsx(N,{placeholder:"请输入标题"})}),e.jsx(S,{label:"描述",name:"description",children:e.jsx(N,{placeholder:"请输入标题"})}),e.jsx(S,{label:"表单布局",name:"layout",children:e.jsxs(q.Group,{children:[e.jsx(q.Button,{value:"horizontal",children:"Horizontal"}),e.jsx(q.Button,{value:"vertical",children:"Vertical"}),e.jsx(q.Button,{value:"inline",children:"inline"})]})}),e.jsx(S,{label:"按钮内容",name:"buttonLabel",children:e.jsx(N,{placeholder:"请输入按钮内容"})})]}),e.jsx(S,{style:{display:"flex",justifyContent:"center"},children:e.jsx(H,{type:"primary",htmlType:"submit",children:"应用"})})]})})},Je=u.memo(We),Qe="_editor_2zcks_1",B={editor:Qe,"editor-main":"_editor-main_2zcks_6"},os=()=>e.jsx(ee,{backend:se,children:e.jsx("div",{className:B.editor,children:e.jsxs(pe,{children:[e.jsx(ge,{}),e.jsxs("div",{className:B["editor-main"],children:[e.jsx(Ce,{}),e.jsx(Be,{}),e.jsx(Je,{})]})]})})});export{os as default};
